[TOC]
# 04. 深入浅出索引-上

## 为什么要有索引
索引的出现是为了提高数据查询的效率，就像书的目录一样

## 索引的常见模型
* 哈希表
    * 添加新的元素会很快，只需要往后追加
    * 不是有序，做区间查询的速度很慢
* 有序数组
    * 更新数据比较慢
* 搜索树
    * 查询复杂度`O(log(N))`
    * 更新时间复杂度`O(log(N))`

## 为什么数据库存储使用多叉树而不是二叉树
你可以想象一下一棵 100 万节点的平衡二叉树，树高 20。一次查询可能需要访问 20 个数据块。即一层一层的往下遍历

多补一句，因为是二叉树结构，每次指针查找很大概率是触发随机磁盘读（比如很难刚好碰上一个节点和他的左右儿子刚好相邻）

而如果是多叉树的话 层级遍历的次数可以大大减少

## InnoDB的索引模型
根据叶子结点的内容，索引类型分为主键索引和非主键索引。

### 主键索引
**主键索引的叶子结点存的是整行数据**。在InnoDB里，主键索引也被称为聚簇索引

小细节
* 存储的就是行数据而行数据的指针
* 但是其实B+树的叶子节点是page （页），一个页里面可以存多个行。
* 这里的页，是mysql 的数据页，默认16kb，里面存储了很多行，还包括页的一些元数据，比如页的页号。每次搜索到页时才会从页里面遍历行得到对应主键的行数据

### 非主键索引
**非主键索引的叶子结点内容是主键的值**。在InnoDB里，非主键索引也被称为耳机索引


![](http://it-learn.oss-cn-beijing.aliyuncs.com/2020/08/16/15975820451143.jpg)

### 基于主键索引和普通索引的查询区别?
如果语句是` select * from T where ID=500`，即主键查询方式，则只需要搜索 ID 这棵 B+ 树；

如果语句是 `select * from T where k=5`，即普通索引查询方式，则需要先搜索 k 索引 树，得到 ID 的值为 500，再到 ID 索引树搜索一次。这个过程称为**回表**。

基于非主键索引的查询需要**多扫描一棵索引树**。因此，我们在应用中应该**尽量使用主键查询**。

### 索引维护
从性能和存储空间方面考量，自增主键往往是更合理的选择。

性能上: 自增主键保证有序插入。写成本较低
存储上: 主键长度越小，普通索引的叶子节点就越小，普通索引占用的空间也就越小。
