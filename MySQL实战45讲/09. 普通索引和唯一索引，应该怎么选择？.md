[TOC]
# 09. 普通索引和唯一索引，应该怎么选择？

## 选择普通索引还是唯一索引？
对于查询过程来说：
* 普通索引，查到满足条件的第一个记录后，继续查找下一个记录，直到第一个不满足条件的记录
* 唯一索引，由于索引唯一性，查到第一个满足条件的记录后，停止检索

但是，两者的性能差距微乎其微。因为InnoDB根据数据页来读写的。

## InnoDB根据数据页来读写
`InnoDB` 的数据是按**数据页**为单位来读写的。也就是说，当需要读一条记录的时候，并不是将这个记录本身从磁盘读出来，而是**以页为单位，将其整体读入内存**。在 `InnoDB` 中，每个数据页的大小默认是 `16KB`。

## change buffer
当需要更新一个数据页时
* 如果数据页在内存中就直接更新
* 如果这个数据页还没有在内存中的话，在不影响数据一致性的前提下，InooDB 会将这些更新操作缓存在 change buffer 中，这样就不需要从磁盘中读入这个数据页了。在下次查询需要访问这个数据页的 时候，将数据页读入内存，然后执行 change buffer 中与这个页有关的操作。通过这种方式就能保证这个数据逻辑的正确性。

需要说明的是，虽然名字叫作 `change buffer`，实际上它是可以持久化的数据

## change buffer 使用场景
change buffer 对更新过程可以起到一定的加速作用

change buffer 只限于用在普通索引的场景下，而不适用于唯一索引。

## 索引的选择和实践：
尽可能使用普通索引。
redo log主要节省的是随机写磁盘的IO消耗(转成顺序写)，而change buffer主要节省的则是随机读磁盘的IO消耗。