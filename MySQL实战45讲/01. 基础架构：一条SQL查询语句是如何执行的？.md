[TOC]
# 01. 基础架构：一条SQL查询语句是如何执行的？

## MySQL 基本架构
![](http://it-learn.oss-cn-beijing.aliyuncs.com/2020/08/22/15980690686595.jpg)

## 连接器
连接器负责跟客户端建立连接、获取权限、维持和管理连接。连接命令一般是这么写的:
```
mysql -h$ip -P$port -u$user -p
```

## 查询缓存
不建议查询缓存，因为一条数据的更新将导致整个表的查询缓存失效

MySQL 8.0 版本直接将查询缓存的整块功能删掉了，也就是说 8.0 开始彻 底没有这个功能了。

## 分析器
分析器负责做“词法分析”
`MySQL` 需要识别出里面的字符串分别是什么，代表什么。

根据词法分析的结果，语法分析器会根据语法 规则，判断你输入的这个 SQL 语句是否满足 MySQL 语法。

Tips:
> 一般语法错误会提示第一个出现错误的位置

## 优化器
优化器是在表里面有多个索引的时候，决定使用哪个索引；或者在一个语句有多表关联 （join）的时候，决定各个表的连接顺序。

## 执行器
负责执行语句


```sql
select * from T where ID=10;
```

如果`ID`字段没有索引，那么执行器的执行流程是这样的： 
1. 调用 InnoDB 引擎接口取这个表的第一行，判断 ID 值是不是 10，如果不是则跳过，如果是则将这行存在结果集中；
2. 调用引擎接口取“下一行”，重复相同的判断逻辑，直到取到这个表的最后一行。
3. 执行器将上述遍历过程中所有满足条件的行组成的记录集作为结果集返回给客户端。

对于有索引的表，执行的逻辑也差不多。第一次调用的是“取满足条件的第一行”这个接 口，之后循环取“满足条件的下一行”这个接口，这些接口都是引擎中已经定义好的。